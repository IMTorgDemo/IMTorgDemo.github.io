<!DOCTYPE html>
<html>
<head>
    <title>Working with XML Data Using Python // IMTorg Kbase</title>

        <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">
        <meta property="og:title" content="Working with XML Data Using Python" />
    <meta property="og:description" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:url" content="https://imtorgdemo.github.io/posts/blog_datastore-xml_elementtree/" />
    

    <link href="" rel="alternate" type="application/rss+xml" title="IMTorg Kbase" />
    
    
    
    <link rel="apple-touch-icon" sizes="57x57" href="/favico/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/favico/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/favico/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/favico/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/favico/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/favico/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/favico/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/favico/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/favico/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favico/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/favico/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favico/favicon-16x16.png">
	<link rel="manifest" href="/images/favico/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">
    

    <link href="https://imtorgdemo.github.io/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
    <link href="https://imtorgdemo.github.io/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="https://imtorgdemo.github.io/css/style.css">

    <meta name="generator" content="Hugo 0.102.3" />
</head>


<body>
<div id="container">
    <header id="header">
    <div id="header-outer" class="outer">
        <div id="header-inner" class="inner">
            <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
            
            <a href="https://imtorgdemo.github.io/">
            	<img src="/logo_CA_newblue.png" alt="Logo" style="max-width:100px; padding-top: 10px">
            </a>
            <nav id="main-nav">
                
                <a class="main-nav-link" href="/pages/about/">About</a>
                
                <a class="main-nav-link" href="/categories/">Categories</a>
                
                <a class="main-nav-link" href="/pages/search/">Search</a>
                
            </nav>
            <nav id="sub-nav">
                <div id="search-form-wrap">
                </div>
            </nav>
        </div>
    </div>
</header>

    <section id="main" class="outer">
        <article class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        <header class="article-header">
            <h1 class="article-title" itemprop="name">Working with XML Data Using Python</h1>
        </header>
        
        <div class="article-meta">
            <a href="/posts/blog_datastore-xml_elementtree/" class="article-date">
                <time datetime='2020-03-26T00:00:00.000&#43;00:00' itemprop="datePublished">2020-03-26</time>
            </a>
            
            
            <div class="post-categories">
                <div class="article-category">
                    
                    
                    <a class="article-category-link" href="https://imtorgdemo.github.io//categories/introduction_tutorial">Introduction_Tutorial</a>
                    
                    
                    <span>&gt;</span>
                    
                    <a class="article-category-link" href="https://imtorgdemo.github.io//categories/data_engineering_and_storage">Data_Engineering_and_Storage</a>
                    
                </div>
            </div>
            
            
        </div>
        <div class="article-entry" itemprop="articleBody">
            <p>Together with JSON, the XML format is the most popular structure for data on the web.  It is not only used for data storage, but also for websites, in the form of HTML.  XML was seen as the ubiquitous data format, but with the ascent of Javascript, JSON became more popular for web applications.  Still, XML is an effective format, and learning to parse and work with it is necessary for anyone who works with a variety of data sources.</p>
<h2 id="introduction-to-elementtree">Introduction to ElementTree</h2>
<p>ElementTree is written in C (formerly cElementTree), and is part of the Python stdlib.  While the API may not be as easy as some other modules, such as minidom and beautifulsoup, ElementTree is quite fast and efficient.  Below are the results of tests performed by the ElementTree maintainers:</p>
<pre tabindex="0"><code>Library                         Time    Space
xml.dom.minidom (Python 2.1)    6.3 s   80000K
gnosis.objectify                2.0 s   22000k
xml.dom.minidom (Python 2.4)    1.4 s   53000k
ElementTree 1.2                 1.6 s   14500k  
ElementTree 1.2.4/1.3           1.1 s   14500k  
cDomlette (C extension)         0.540 s 20500k
PyRXPU (C extension)            0.175 s 10850k
libxml2 (C extension)           0.098 s 16000k
readlines (read as utf-8)       0.093 s 8850k
cElementTree (C extension)  --&gt; 0.047 s 4900K &lt;--
readlines (read as ascii)       0.032 s 5050k  
</code></pre><h2 id="config">Config</h2>
<p>Begin by ensuring that your xml file is well-formed.  You can get a sense of this by visual inspection.  If the XML is not valid, then you will not be able to load the file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span> ls Data<span style="color:#f92672">/</span>example<span style="color:#f92672">/</span>
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">example.xml
</code></pre>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span> head <span style="color:#f92672">-</span>n3 Data<span style="color:#f92672">/</span>example<span style="color:#f92672">/</span>example<span style="color:#f92672">.</span>xml
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">&lt;?xml version=&#34;1.0&#34;?&gt;
&lt;collection&gt;
    &lt;genre category=&#34;Action&#34;&gt;
</code></pre>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span> tail <span style="color:#f92672">-</span>n3 Data<span style="color:#f92672">/</span>example<span style="color:#f92672">/</span>example<span style="color:#f92672">.</span>xml
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">        &lt;/decade&gt;
    &lt;/genre&gt;
&lt;/collection&gt;
</code></pre>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> xml.etree.ElementTree <span style="color:#66d9ef">as</span> ET
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>file_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./Data/example/example.xml&#39;</span>
</span></span><span style="display:flex;"><span>tree <span style="color:#f92672">=</span> ET<span style="color:#f92672">.</span>parse(file_path)
</span></span></code></pre></div><h2 id="explore">Explore</h2>
<p>Continue exploring the structure of the xml.  There is typically a level of the branch where there are many leaves.  These leaves are often the data you are most interested in examining.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>root <span style="color:#f92672">=</span> tree<span style="color:#f92672">.</span>getroot()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print( root )
</span></span><span style="display:flex;"><span>print( root<span style="color:#f92672">.</span>tag )
</span></span><span style="display:flex;"><span>print( root<span style="color:#f92672">.</span>attrib )
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">&lt;Element &#39;collection&#39; at 0x7fc18cd36db8&gt;
collection
{}
</code></pre>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[(x<span style="color:#f92672">.</span>tag, x<span style="color:#f92672">.</span>attrib) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> root]
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">[(&#39;genre&#39;, {&#39;category&#39;: &#39;Action&#39;}), (&#39;genre&#39;, {&#39;category&#39;: &#39;Thriller&#39;})]
</code></pre>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[(x<span style="color:#f92672">.</span>tag, x<span style="color:#f92672">.</span>attrib) <span style="color:#66d9ef">for</span> idx,x <span style="color:#f92672">in</span> enumerate(root<span style="color:#f92672">.</span>iter()) <span style="color:#66d9ef">if</span> idx <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>]
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">[(&#39;collection&#39;, {}),
 (&#39;genre&#39;, {&#39;category&#39;: &#39;Action&#39;}),
 (&#39;decade&#39;, {&#39;years&#39;: &#39;1980s&#39;}),
 (&#39;movie&#39;,
  {&#39;favorite&#39;: &#39;True&#39;, &#39;title&#39;: &#39;Indiana Jones: The raiders of the lost Ark&#39;}),
 (&#39;format&#39;, {&#39;multiple&#39;: &#39;No&#39;}),
 (&#39;year&#39;, {}),
 (&#39;rating&#39;, {}),
 (&#39;description&#39;, {}),
 (&#39;movie&#39;, {&#39;favorite&#39;: &#39;True&#39;, &#39;title&#39;: &#39;THE KARATE KID&#39;}),
 (&#39;format&#39;, {&#39;multiple&#39;: &#39;Yes&#39;})]
</code></pre>

</div>

<p>It looks like a path of branches gets us to our <code>movie</code> leaf.  To get there we must follow: <code>/genre/decade/movie</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(ET<span style="color:#f92672">.</span>tostring(root, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf8&#39;</span>)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf8&#39;</span>)[:<span style="color:#ae81ff">700</span>])
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">&lt;?xml version=&#39;1.0&#39; encoding=&#39;utf8&#39;?&gt;
&lt;collection&gt;
    &lt;genre category=&#34;Action&#34;&gt;
        &lt;decade years=&#34;1980s&#34;&gt;
            &lt;movie favorite=&#34;True&#34; title=&#34;Indiana Jones: The raiders of the lost Ark&#34;&gt;
                &lt;format multiple=&#34;No&#34;&gt;DVD&lt;/format&gt;
                &lt;year&gt;1981&lt;/year&gt;
                &lt;rating&gt;PG&lt;/rating&gt;
                &lt;description&gt;
                &#39;Archaeologist and adventurer Indiana Jones 
                is hired by the U.S. government to find the Ark of the 
                Covenant before the Nazis.&#39;
                &lt;/description&gt;
            &lt;/movie&gt;
               &lt;movie favorite=&#34;True&#34; title=&#34;THE KARATE KID&#34;&gt;
               &lt;format multiple=&#34;Yes&#34;&gt;DVD,Online&lt;/format&gt;
 
</code></pre>

</div>

<h2 id="xpath-expressions">XPath Expressions</h2>
<p>XPath is a query language used to search through an XML quickly and easily. XPath is a &ldquo;path like&rdquo; syntax to identify and navigate nodes in an XML document.</p>
<p>ElementTree has a <code>.findall()</code> function that will traverse the immediate children of the referenced element. You can use XPath expressions to specify more useful searches.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> movie <span style="color:#f92672">in</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#34;./genre/decade/movie&#34;</span>):
</span></span><span style="display:flex;"><span>    print(movie<span style="color:#f92672">.</span>attrib)
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">{&#39;favorite&#39;: &#39;True&#39;, &#39;title&#39;: &#39;Indiana Jones: The raiders of the lost Ark&#39;}
{&#39;favorite&#39;: &#39;True&#39;, &#39;title&#39;: &#39;THE KARATE KID&#39;}
{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;Back 2 the Future&#39;}
{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;X-Men&#39;}
{&#39;favorite&#39;: &#39;True&#39;, &#39;title&#39;: &#39;Batman Returns&#39;}
{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;Reservoir Dogs&#39;}
{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;ALIEN&#39;}
{&#39;favorite&#39;: &#39;True&#39;, &#39;title&#39;: &#34;Ferris Bueller&#39;s Day Off&#34;}
{&#39;favorite&#39;: &#39;FALSE&#39;, &#39;title&#39;: &#39;American Psycho&#39;}
</code></pre>

</div>

<p>Search on child tag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> leaf <span style="color:#f92672">in</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#34;./genre/decade/movie/[year=&#39;1992&#39;]&#34;</span>):
</span></span><span style="display:flex;"><span>    print(leaf<span style="color:#f92672">.</span>attrib)
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">{&#39;favorite&#39;: &#39;True&#39;, &#39;title&#39;: &#39;Batman Returns&#39;}
{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;Reservoir Dogs&#39;}
</code></pre>

</div>

<p>Search on child tag&rsquo;s attribute</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> leaf <span style="color:#f92672">in</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#34;./genre/decade/movie/format/[@multiple=&#39;Yes&#39;]&#34;</span>):
</span></span><span style="display:flex;"><span>    print(leaf)
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">&lt;Element &#39;format&#39; at 0x7fc18c4e6138&gt;
&lt;Element &#39;format&#39; at 0x7fc18c4e64a8&gt;
&lt;Element &#39;format&#39; at 0x7fc18c4e69f8&gt;
</code></pre>

</div>

<p>use <code>...</code> inside of XPath to return the parent element of the current element.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> leaf <span style="color:#f92672">in</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#34;./genre/decade/movie/format/[@multiple=&#39;Yes&#39;]...&#34;</span>):
</span></span><span style="display:flex;"><span>    print(leaf<span style="color:#f92672">.</span>attrib)
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">{&#39;favorite&#39;: &#39;True&#39;, &#39;title&#39;: &#39;THE KARATE KID&#39;}
{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;X-Men&#39;}
{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;ALIEN&#39;}
</code></pre>

</div>

<h2 id="modifying-xml">Modifying XML</h2>
<h3 id="single-element">Single element</h3>
<p>Obtain a single element of the tree and assign it to a variable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>b2tf <span style="color:#f92672">=</span> root<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;./genre/decade/movie[@title=&#39;Back 2 the Future&#39;]&#34;</span>)
</span></span><span style="display:flex;"><span>print(b2tf)
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">&lt;Element &#39;movie&#39; at 0x7fc18c4e6278&gt;
</code></pre>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>b2tf<span style="color:#f92672">.</span>attrib
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;Back 2 the Future&#39;}
</code></pre>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>b2tf<span style="color:#f92672">.</span>attrib[<span style="color:#e6db74">&#34;title&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Back to the Future&#34;</span>
</span></span><span style="display:flex;"><span>print(b2tf<span style="color:#f92672">.</span>attrib)
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;Back to the Future&#39;}
</code></pre>

</div>

<p>Because the assignment is not a deep copy, the change is made, in-place.  Now, we can write the corrected tree to file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> movie <span style="color:#f92672">in</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#34;./genre/decade/movie&#34;</span>):
</span></span><span style="display:flex;"><span>    print(movie<span style="color:#f92672">.</span>attrib)
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">{&#39;favorite&#39;: &#39;True&#39;, &#39;title&#39;: &#39;Indiana Jones: The raiders of the lost Ark&#39;}
{&#39;favorite&#39;: &#39;True&#39;, &#39;title&#39;: &#39;THE KARATE KID&#39;}
{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;Back to the Future&#39;}
{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;X-Men&#39;}
{&#39;favorite&#39;: &#39;True&#39;, &#39;title&#39;: &#39;Batman Returns&#39;}
{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;Reservoir Dogs&#39;}
{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;ALIEN&#39;}
{&#39;favorite&#39;: &#39;True&#39;, &#39;title&#39;: &#34;Ferris Bueller&#39;s Day Off&#34;}
{&#39;favorite&#39;: &#39;FALSE&#39;, &#39;title&#39;: &#39;American Psycho&#39;}
</code></pre>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(file_path)
</span></span><span style="display:flex;"><span>corr_file <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(path,<span style="color:#e6db74">&#34;example_corr.xml&#34;</span>)
</span></span><span style="display:flex;"><span>tree<span style="color:#f92672">.</span>write(corr_file)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span> ls Data<span style="color:#f92672">/</span>example
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">example_corr.xml  example.xml
</code></pre>

</div>

<h3 id="multiple-elements">Multiple elements</h3>
<p>You can use regex to find commas - that will tell whether the multiple attribute should be &ldquo;Yes&rdquo; or &ldquo;No&rdquo;. Adding and modifying attributes can be done easily with the .set() method.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> form <span style="color:#f92672">in</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#34;./genre/decade/movie/format&#34;</span>):
</span></span><span style="display:flex;"><span>    print(form<span style="color:#f92672">.</span>attrib, form<span style="color:#f92672">.</span>text)
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">{&#39;multiple&#39;: &#39;No&#39;} DVD
{&#39;multiple&#39;: &#39;Yes&#39;} DVD,Online
{&#39;multiple&#39;: &#39;False&#39;} Blu-ray
{&#39;multiple&#39;: &#39;Yes&#39;} dvd, digital
{&#39;multiple&#39;: &#39;No&#39;} VHS
{&#39;multiple&#39;: &#39;No&#39;} Online
{&#39;multiple&#39;: &#39;Yes&#39;} DVD
{&#39;multiple&#39;: &#39;No&#39;} DVD
{&#39;multiple&#39;: &#39;No&#39;} blue-ray
</code></pre>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> form <span style="color:#f92672">in</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#34;./genre/decade/movie/format&#34;</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Search for the commas in the format text</span>
</span></span><span style="display:flex;"><span>    match <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;,&#39;</span>,form<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> match:
</span></span><span style="display:flex;"><span>        form<span style="color:#f92672">.</span>set(<span style="color:#e6db74">&#39;multiple&#39;</span>,<span style="color:#e6db74">&#39;Yes&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        form<span style="color:#f92672">.</span>set(<span style="color:#e6db74">&#39;multiple&#39;</span>,<span style="color:#e6db74">&#39;No&#39;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> form <span style="color:#f92672">in</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#34;./genre/decade/movie/format&#34;</span>):
</span></span><span style="display:flex;"><span>    print(form<span style="color:#f92672">.</span>attrib, form<span style="color:#f92672">.</span>text)
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">{&#39;multiple&#39;: &#39;No&#39;} DVD
{&#39;multiple&#39;: &#39;Yes&#39;} DVD,Online
{&#39;multiple&#39;: &#39;No&#39;} Blu-ray
{&#39;multiple&#39;: &#39;Yes&#39;} dvd, digital
{&#39;multiple&#39;: &#39;No&#39;} VHS
{&#39;multiple&#39;: &#39;No&#39;} Online
{&#39;multiple&#39;: &#39;No&#39;} DVD
{&#39;multiple&#39;: &#39;No&#39;} DVD
{&#39;multiple&#39;: &#39;No&#39;} blue-ray
</code></pre>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(file_path)
</span></span><span style="display:flex;"><span>corr_file <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(path,<span style="color:#e6db74">&#34;example_corr.xml&#34;</span>)
</span></span><span style="display:flex;"><span>tree<span style="color:#f92672">.</span>write(corr_file)
</span></span></code></pre></div><h3 id="move-elements">Move elements</h3>
<p>Check if movies are correctly categorized by year, and fix them if not.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> decade <span style="color:#f92672">in</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#34;./genre/decade&#34;</span>):
</span></span><span style="display:flex;"><span>    print(decade<span style="color:#f92672">.</span>attrib)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> year <span style="color:#f92672">in</span> decade<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#34;./movie/year&#34;</span>):
</span></span><span style="display:flex;"><span>        print(year<span style="color:#f92672">.</span>text, <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">{&#39;years&#39;: &#39;1980s&#39;}
1981 

1984 

1985 

{&#39;years&#39;: &#39;1990s&#39;}
2000 

1992 

1992 

{&#39;years&#39;: &#39;1970s&#39;}
1979 

{&#39;years&#39;: &#39;1980s&#39;}
1986 

2000 
</code></pre>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> movie <span style="color:#f92672">in</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#34;./genre/decade/movie/[year=&#39;2000&#39;]&#34;</span>):
</span></span><span style="display:flex;"><span>    print(movie<span style="color:#f92672">.</span>attrib)
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">{&#39;favorite&#39;: &#39;False&#39;, &#39;title&#39;: &#39;X-Men&#39;}
{&#39;favorite&#39;: &#39;FALSE&#39;, &#39;title&#39;: &#39;American Psycho&#39;}
</code></pre>

</div>

<p>Add a new decade tag to the end of the XML using the <code>.SubElement()</code> method.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>action <span style="color:#f92672">=</span> root<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;./genre[@category=&#39;Action&#39;]&#34;</span>)
</span></span><span style="display:flex;"><span>new_dec <span style="color:#f92672">=</span> ET<span style="color:#f92672">.</span>SubElement(action, <span style="color:#e6db74">&#39;decade&#39;</span>)
</span></span><span style="display:flex;"><span>new_dec<span style="color:#f92672">.</span>attrib[<span style="color:#e6db74">&#34;years&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2000s&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(ET<span style="color:#f92672">.</span>tostring(action, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf8&#39;</span>)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf8&#39;</span>)[:<span style="color:#ae81ff">500</span>])
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">&lt;?xml version=&#39;1.0&#39; encoding=&#39;utf8&#39;?&gt;
&lt;genre category=&#34;Action&#34;&gt;
        &lt;decade years=&#34;1980s&#34;&gt;
            &lt;movie favorite=&#34;True&#34; title=&#34;Indiana Jones: The raiders of the lost Ark&#34;&gt;
                &lt;format multiple=&#34;No&#34;&gt;DVD&lt;/format&gt;
                &lt;year&gt;1981&lt;/year&gt;
                &lt;rating&gt;PG&lt;/rating&gt;
                &lt;description&gt;
                &#39;Archaeologist and adventurer Indiana Jones 
                is hired by the U.S. government to find the Ark of the 
                Covenant before th
</code></pre>

</div>

<p>Use <code>.append()</code> and <code>.remove()</code> to move the element.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>xmen <span style="color:#f92672">=</span> root<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;./genre/decade/movie[@title=&#39;X-Men&#39;]&#34;</span>)
</span></span><span style="display:flex;"><span>dec2000s <span style="color:#f92672">=</span> root<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;./genre[@category=&#39;Action&#39;]/decade[@years=&#39;2000s&#39;]&#34;</span>)
</span></span><span style="display:flex;"><span>dec2000s<span style="color:#f92672">.</span>append(xmen)
</span></span><span style="display:flex;"><span>dec1990s <span style="color:#f92672">=</span> root<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;./genre[@category=&#39;Action&#39;]/decade[@years=&#39;1990s&#39;]&#34;</span>)
</span></span><span style="display:flex;"><span>dec1990s<span style="color:#f92672">.</span>remove(xmen)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(ET<span style="color:#f92672">.</span>tostring(action, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf8&#39;</span>)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf8&#39;</span>)[:<span style="color:#ae81ff">500</span>])
</span></span></code></pre></div><div class="output">

<pre tabindex="0"><code class="language-nb-output" data-lang="nb-output">&lt;?xml version=&#39;1.0&#39; encoding=&#39;utf8&#39;?&gt;
&lt;genre category=&#34;Action&#34;&gt;
        &lt;decade years=&#34;1980s&#34;&gt;
            &lt;movie favorite=&#34;True&#34; title=&#34;Indiana Jones: The raiders of the lost Ark&#34;&gt;
                &lt;format multiple=&#34;No&#34;&gt;DVD&lt;/format&gt;
                &lt;year&gt;1981&lt;/year&gt;
                &lt;rating&gt;PG&lt;/rating&gt;
                &lt;description&gt;
                &#39;Archaeologist and adventurer Indiana Jones 
                is hired by the U.S. government to find the Ark of the 
                Covenant before th
</code></pre>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(file_path)
</span></span><span style="display:flex;"><span>corr_file <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(path,<span style="color:#e6db74">&#34;example_corr.xml&#34;</span>)
</span></span><span style="display:flex;"><span>tree<span style="color:#f92672">.</span>write(corr_file)
</span></span></code></pre></div><h2 id="xml-schema-xsd">XML schema (.xsd)</h2>
<p>ElementTree does not have support for XML schema.  However, lxml library is based on ElementTree, and it does have support for schemas.  If you have access to external libraries and need the functionality, then lxml may solve your problems.</p>
<p>With a <code>XMLSchema</code> you can enforce the schema standards.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> lxml <span style="color:#f92672">import</span> etree
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create the schema object</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(xsd_file) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    xmlschema_doc <span style="color:#f92672">=</span> etree<span style="color:#f92672">.</span>parse(f)
</span></span><span style="display:flex;"><span>xmlschema <span style="color:#f92672">=</span> etree<span style="color:#f92672">.</span>XMLSchema(xmlschema_doc)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create a tree for the XML document</span>
</span></span><span style="display:flex;"><span>doc <span style="color:#f92672">=</span> etree<span style="color:#f92672">.</span>parse(xml_text)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Validate the XML document using the schema</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> xmlschema<span style="color:#f92672">.</span>validate(doc)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Or if you want a exception to be raised</span>
</span></span><span style="display:flex;"><span>xmlschema<span style="color:#f92672">.</span>assertValid(doc)
</span></span></code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>Working with XML is an important skill, and Python stdlib&rsquo;s ElementTree library is invaluable for getting things done fast.  With a little knowledge of the ElementTree API and XPath expressions, you&rsquo;re fully capable of most functionality needed for XML CRUD operations.</p>

        </div>

        
        
        <div class="article-toc" style="display:none;">
            <h3>Contents</h3>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction-to-elementtree">Introduction to ElementTree</a></li>
    <li><a href="#config">Config</a></li>
    <li><a href="#explore">Explore</a></li>
    <li><a href="#xpath-expressions">XPath Expressions</a></li>
    <li><a href="#modifying-xml">Modifying XML</a>
      <ul>
        <li><a href="#single-element">Single element</a></li>
        <li><a href="#multiple-elements">Multiple elements</a></li>
        <li><a href="#move-elements">Move elements</a></li>
      </ul>
    </li>
    <li><a href="#xml-schema-xsd">XML schema (.xsd)</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
        </div>
        
        

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin="anonymous"></script>
        <script>
            (function() {
                var $toc = $('#TableOfContents');
                if ($toc.length > 0) {
                    var $window = $(window);

                    function onScroll(){
                        var currentScroll = $window.scrollTop();
                        var h = $('.article-entry h1, .article-entry h2, .article-entry h3, .article-entry h4, .article-entry h5, .article-entry h6');
                        var id = "";
                        h.each(function (i, e) {
                            e = $(e);
                            if (e.offset().top - 10 <= currentScroll) {
                                id = e.attr('id');
                            }
                        });
                        var active = $toc.find('a.active');
                        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

                        active.each(function (i, e) {
                            $(e).removeClass('active').siblings('ul').hide();
                        });
                        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
                            $(e).children('a').addClass('active').siblings('ul').show();
                        });
                    }

                    $window.on('scroll', onScroll);
                    $(document).ready(function() {
                        $toc.find('a').parent('li').find('ul').hide();
                        onScroll();
                        document.getElementsByClassName('article-toc')[0].style.display = '';
                    });
                }
            })();
        </script>
        


        
        <footer class="article-footer">
            <ul class="article-tag-list">
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="https://imtorgdemo.github.io//tags/xml">xml
                    </a>
                </li>
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="https://imtorgdemo.github.io//tags/python">python
                    </a>
                </li>
                
            </ul>
        </footer>
        
    </div>
    <nav id="article-nav">
    
    <a href="/posts/blog_programming_py-pipenv_virtualenv/" id="article-nav-newer" class="article-nav-link-wrap">
        <div class="article-nav-title"><span>&lt;</span>&nbsp;
            A Cheatsheet for Python&#39;s Pipenv
        </div>
    </a>
    
    
    <a href="/posts/blog_ds-intro_numpy_pandas/" id="article-nav-older" class="article-nav-link-wrap">
        <div class="article-nav-title">An Introduction to Numpy and Pandas&nbsp;<span>&gt;</span></div>
    </a>
    
</nav>

</article>

        
    </section>
    <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2022 IMTorg Kbase
            <br />
            <b> Want to discuss software?</b><br>Send me a message <a href="mailto:information@mgmt-tech.org?Subject=Open%20Software" target="_top"></a> information@mgmt-tech.org
        </div>
    </div>
    

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/tomorrow-night.min.css" integrity="sha256-2wL88NKUqvJi/ExflDzkzUumjUM73mcK2gBvBBeLvTk=" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin="anonymous"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha256-ExtbCSBuYA7kq1Pz362ibde9nnsHYPt6JxuxYeZbU+c=" crossorigin="anonymous"></script>
        <script>renderMathInElement(document.body);</script>
    
    <script>
        document.getElementById('main-nav-toggle').addEventListener('click', function () {
            var header = document.getElementById('header');
            if (header.classList.contains('mobile-on')) {
                header.classList.remove('mobile-on');
            } else {
                header.classList.add('mobile-on');
            }
        });
    </script>
    <script 
	src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.8/lunr.min.js" 
	integrity="sha256-34Si1Y6llMBKM3G0jQILVeoQKEwuxjbk4zGWXXMT4ps=" 
	crossorigin="anonymous"></script>
	<script src="https://imtorgdemo.github.io/js/search.js"></script>
</footer>
</div>
</body>
</html>
